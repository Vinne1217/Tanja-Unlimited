Subject: Campaign Price API Missing Metadata Fields

Hi Customer Portal Team,

We're implementing campaign price display on the tenant frontend, but the campaign price API response is missing required metadata fields needed to display discounted prices correctly.

CURRENT ISSUE:

API Endpoint: GET /api/campaigns/price/{productId}?tenant={tenantId}&originalPriceId={priceId}

Current Response:
{
  "success": true,
  "hasCampaignPrice": true,
  "priceId": "price_1SmxOl1fkdOqt85xxqgkhC2o",
  "campaignId": "695e68a2d4de0f9731a5ea85",
  "campaignName": "Test",
  "originalPriceId": null
}

Problem: Missing "metadata" object and "amount" field, which are needed to display the discounted price on the frontend.

REQUIRED RESPONSE FORMAT:

Please update the API response to include:

{
  "success": true,
  "hasCampaignPrice": true,
  "priceId": "price_1SmxOl1fkdOqt85xxqgkhC2o",
  "campaignId": "695e68a2d4de0f9731a5ea85",
  "campaignName": "Test",
  "originalPriceId": "price_1SmchQ1fkdOqt85xhAcJUQuN",
  "amount": 47500,  // REQUIRED: Campaign price in cents (475 SEK)
  "metadata": {     // REQUIRED: Metadata object
    "discount_percent": 5,           // REQUIRED: Discount percentage (5%)
    "unit_amount": 47500,            // Campaign price in cents
    "original_unit_amount": 50000,   // Original price in cents
    "campaign_name": "Test",
    "original_price_id": "price_1SmchQ1fkdOqt85xhAcJUQuN"
  }
}

WHY THIS IS NEEDED:

1. Stripe Connect Prices: Campaign prices are created in the Stripe Connect account (connected account), not the platform account
2. Frontend Cannot Access: The tenant frontend uses platform account keys and cannot directly fetch prices from the connected account
3. Display Requirements: The frontend needs the price amount and discount percentage to:
   - Display the discounted price correctly
   - Show the discount percentage badge
   - Calculate savings amount

IMPLEMENTATION OPTIONS:

Option 1: Include Price Data When Creating Campaign Prices (Recommended)

When creating campaign prices in Stripe Connect, store the price amount in your database and return it in the API:

// When creating campaign price in Stripe Connect
const campaignPrice = await stripe.prices.create({
  // ... price creation
}, { stripeAccount: connectedAccountId });

// Store in database
await CampaignPrice.create({
  stripePriceId: campaignPrice.id,
  unitAmount: campaignPrice.unit_amount,  // Store amount
  discountPercent: campaign.discountValue,
  originalUnitAmount: originalPrice.unit_amount,
  // ...
});

// In API response
return {
  priceId: campaignPrice.id,
  amount: campaignPrice.unit_amount,  // Return stored amount
  metadata: {
    discount_percent: campaign.discountValue,
    unit_amount: campaignPrice.unit_amount,
    original_unit_amount: originalPrice.unit_amount,
    campaign_name: campaign.name,
    original_price_id: originalPriceId
  }
};

Option 2: Fetch from Stripe Connect in API

Fetch the price from Stripe Connect account when responding to the API request:

// In /api/campaigns/price/{productId} endpoint
const stripe = new Stripe(process.env.STRIPE_SECRET_KEY);

// Fetch campaign price from Stripe Connect account
const campaignPrice = await stripe.prices.retrieve(priceId, {
  stripeAccount: connectedAccountId  // Stripe Connect account ID
});

// Fetch original price for comparison
const originalPrice = await stripe.prices.retrieve(originalPriceId, {
  stripeAccount: connectedAccountId
});

// Calculate discount
const discountPercent = Math.round(
  ((originalPrice.unit_amount - campaignPrice.unit_amount) / originalPrice.unit_amount) * 100
);

return {
  priceId: campaignPrice.id,
  amount: campaignPrice.unit_amount,  // Campaign price in cents
  metadata: {
    discount_percent: discountPercent,
    unit_amount: campaignPrice.unit_amount,
    original_unit_amount: originalPrice.unit_amount,
    campaign_name: campaign.name,
    original_price_id: originalPriceId
  }
};

TESTING:

After implementation, please test with:

curl "https://source-database-809785351172.europe-north1.run.app/api/campaigns/price/prod_Tk6vhGPrHRjLg5?tenant=tanjaunlimited&originalPriceId=price_1SmchQ1fkdOqt85xhAcJUQuN"

Expected Response Should Include:
- amount field (campaign price in cents)
- metadata object
- metadata.discount_percent (discount percentage)
- metadata.unit_amount (campaign price)
- metadata.original_unit_amount (original price)

CURRENT WORKAROUND:

Until this is implemented:
- Campaign badge shows (displays campaign name)
- Price shows incorrectly (shows original price instead of discounted price)
- Checkout works correctly (backend handles campaign prices)

PRIORITY:

High - This is blocking correct campaign price display on the tenant frontend. Once implemented, campaigns will display correctly with discounted prices and discount percentages.

Thank you!

